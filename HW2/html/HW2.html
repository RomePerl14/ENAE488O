<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>HW2</title>
<meta name="generator" content="MATLAB 24.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-05-01">
<meta name="DC.source" content="HW2.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">Romeo Perlstein HW2</a>
</li>
<li>
<a href="#2">Q1</a>
</li>
</ul>
</div>
<h2 id="1">Romeo Perlstein HW2</h2>
<p>Help! I need somebody</p>
<pre class="codeinput">close <span class="string">all</span>
clear
</pre>
<h2 id="2">Q1</h2>
<p>given the following grpah:</p>
<pre class="codeinput">G = [2 0 0 0 0;
     0 2 0 0 0;
     0 0 2 0 0;
     0 0 0 2 0;
     0 0 0 0 2];
A = [0 1 0 0 1;
     1 0 1 0 0;
     0 1 0 1 0;
     0 0 1 0 1;
     1 0 0 1 0];

L = G - A;

<span class="comment">% Given</span>
x0_vec = [-4, -5;
          -2,  2;
           1,  6;
           7,  0;
           5, -6];

k_vec_relative = [0, -1;
                  0,  1;
                  1,  0;
                  0,  0;
                 -1, -1];
<span class="comment">% k_vec_relative = [1,1;</span>
<span class="comment">%                   0,0;</span>
<span class="comment">%                   0,0;</span>
<span class="comment">%                   0,0;</span>
<span class="comment">%                   0,0];</span>

<span class="comment">% k = x0_vec + k_vec_relative</span>
k = k_vec_relative

v0_vec = zeros(5,2);

z0_vec = [x0_vec; v0_vec];
z0_vec_1d = z0_vec(:);

k_gain = 2.5;
gamma_gain = 0.7;

tall_er_ant = (10^-13); <span class="comment">% Tolerance</span>
step_size = 0.025; <span class="comment">% step size</span>
max_time = 8; <span class="comment">% max time (0-&gt;max_time)</span>
t = [0:step_size:max_time]; <span class="comment">% timestep</span>

<span class="comment">% ODE options</span>
ODE_options = odeset(<span class="string">"RelTol"</span>, tall_er_ant, <span class="string">"AbsTol"</span>, tall_er_ant);

[T,Z] = ode45(@myodefun, t, z0_vec_1d, ODE_options, A, k, k_gain, gamma_gain);

z_state.x1 = [Z(:,1), Z(:,11)];
z_state.x2 = [Z(:,2), Z(:,12)];
z_state.x3 = [Z(:,3), Z(:,13)];
z_state.x4 = [Z(:,4), Z(:,14)];
z_state.x5 = [Z(:,5), Z(:,15)];

z_state.v1 = [Z(:,6), Z(:,16)];
z_state.v2 = [Z(:,7), Z(:,17)];
z_state.v3 = [Z(:,8), Z(:,18)];
z_state.v4 = [Z(:,9), Z(:,19)];
z_state.v5 = [Z(:,10), Z(:,20)];

count = 1;
z_state.psi1 = zeros(length(t),2);
z_state.psi2 = zeros(length(t),2);
z_state.psi3 = zeros(length(t),2);
z_state.psi4 = zeros(length(t),2);
z_state.psi5 = zeros(length(t),2);

<span class="keyword">for</span> i = 1:length(t)
    z_state.psi1(i, :) = z_state.x1(i,:) - k(1,:);
    z_state.psi2(i, :) = z_state.x2(i,:) - k(2,:);
    z_state.psi3(i, :) = z_state.x3(i,:) - k(3,:);
    z_state.psi4(i, :) = z_state.x4(i,:) - k(4,:);
    z_state.psi5(i, :) = z_state.x5(i,:) - k(5,:);
<span class="keyword">end</span>

<span class="comment">% z_state.psi1 = [Z(:,11), Z(:,26)];</span>
<span class="comment">% z_state.psi2 = [Z(:,12), Z(:,27)];</span>
<span class="comment">% z_state.psi3 = [Z(:,13), Z(:,28)];</span>
<span class="comment">% z_state.psi4 = [Z(:,14), Z(:,29)];</span>
<span class="comment">% z_state.psi5 = [Z(:,15), Z(:,30)];</span>
<span class="comment">%</span>
<span class="comment">% Position</span>
figure;
hold <span class="string">on</span>
plot(t, z_state.x1)
yline(k(1,1), <span class="string">"b-."</span>)
yline(k(1,2), <span class="string">"r-."</span>)
legend([<span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"x_{desired}"</span>, <span class="string">"y_{desired}"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 1 Position State Over Time"</span>)
grid <span class="string">on</span>

figure;
hold <span class="string">on</span>
plot(t, z_state.x2)
yline(k(2,1), <span class="string">"b-."</span>)
yline(k(2,2), <span class="string">"r-."</span>)
legend([<span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"x_{desired}"</span>, <span class="string">"y_{desired}"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 2 Position State Over Time"</span>)
grid <span class="string">on</span>
ylim([-3, 4])

figure;
hold <span class="string">on</span>
plot(t, z_state.x3)
yline(k(3,1), <span class="string">"b-."</span>)
yline(k(3,2), <span class="string">"r-."</span>)
legend([<span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"x_{desired}"</span>, <span class="string">"y_{desired}"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 3 Position State Over Time"</span>)
grid <span class="string">on</span>

figure;
hold <span class="string">on</span>
plot(t, z_state.x4)
yline(k(4,1), <span class="string">"b-."</span>)
yline(k(4,2), <span class="string">"r-."</span>)
legend([<span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"x_{desired}"</span>, <span class="string">"y_{desired}"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 4 Position State Over Time"</span>)
grid <span class="string">on</span>

figure;
hold <span class="string">on</span>
plot(t, z_state.x5)
yline(k(5,1), <span class="string">"b-."</span>)
yline(k(5,2), <span class="string">"r-."</span>)
legend([<span class="string">"x"</span>, <span class="string">"y"</span>, <span class="string">"x_{desired}"</span>, <span class="string">"y_{desired}"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 5 Position State Over Time"</span>)
grid <span class="string">on</span>


<span class="comment">% Velocity</span>
figure;
hold <span class="string">on</span>
plot(t, z_state.v1)
legend([<span class="string">"v_x"</span>, <span class="string">"v_y"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 1 Velocity State Over Time"</span>)
grid <span class="string">on</span>

figure;
hold <span class="string">on</span>
plot(t, z_state.v2)
legend([<span class="string">"v_x"</span>, <span class="string">"v_y"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 2 Velocity State Over Time"</span>)
grid <span class="string">on</span>

figure;
hold <span class="string">on</span>
plot(t, z_state.v3)
legend([<span class="string">"v_x"</span>, <span class="string">"v_y"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 3 Velocity State Over Time"</span>)
grid <span class="string">on</span>

figure;
hold <span class="string">on</span>
plot(t, z_state.v4)
legend([<span class="string">"v_x"</span>, <span class="string">"v_y"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 4 Velocity State Over Time"</span>)
grid <span class="string">on</span>

figure;
hold <span class="string">on</span>
plot(t, z_state.v5)
legend([<span class="string">"v_x"</span>, <span class="string">"v_y"</span>])
xlabel(<span class="string">"time (s)"</span>)
ylabel(<span class="string">"state"</span>)
title(<span class="string">"Plot of Node 5 Velocity State Over Time"</span>)
grid <span class="string">on</span>



<span class="comment">% figure;</span>
<span class="comment">% title("Plot of \psi Over Time")</span>
<span class="comment">% xlabel("X")</span>
<span class="comment">% ylabel("Y")</span>
<span class="comment">% hold on</span>
<span class="comment">% grid on</span>
<span class="comment">% yline(0, "-.");</span>
<span class="comment">% xline(0, "-.");</span>
<span class="comment">% for i = 1:length(T)</span>
<span class="comment">%     plot(z_state.psi1(1:i,1), z_state.psi1(1:i,2), "blue", LineWidth=1.5)</span>
<span class="comment">%     plot(z_state.psi2(1:i,1), z_state.psi2(1:i,2), "red", LineWidth=1.5)</span>
<span class="comment">%     plot(z_state.psi3(1:i,1), z_state.psi3(1:i,2), "green", LineWidth=1.5)</span>
<span class="comment">%     plot(z_state.psi4(1:i,1), z_state.psi4(1:i,2), "magenta", LineWidth=1.5)</span>
<span class="comment">%     plot(z_state.psi5(1:i,1), z_state.psi5(1:i,2), "black", LineWidth=1.5)</span>
<span class="comment">%</span>
<span class="comment">%     drawnow</span>
<span class="comment">% end</span>
<span class="comment">% scatter(z_state.psi1(end,1), z_state.psi1(end,2), "blue")</span>
<span class="comment">% scatter(z_state.psi2(end,1), z_state.psi2(end,2), "red")</span>
<span class="comment">% scatter(z_state.psi3(end,1), z_state.psi3(end,2), "green")</span>
<span class="comment">% scatter(z_state.psi4(end,1), z_state.psi4(end,2), "magenta")</span>
<span class="comment">% scatter(z_state.psi5(end,1), z_state.psi5(end,2), "black")</span>
<span class="comment">% legend(["x_0", "y_0", "V_1", "V_2", "V_3", "V_4", "V_5"])</span>
<span class="comment">%</span>
<span class="comment">%</span>
<span class="comment">%</span>
<span class="comment">% figure;</span>
<span class="comment">% hold on;</span>
<span class="comment">% grid on;</span>
<span class="comment">% title("Plot of X State (Top-down View)")</span>
<span class="comment">% xlabel("X")</span>
<span class="comment">% ylabel("Y")</span>
<span class="comment">% axis equal</span>
<span class="comment">% xlim([-5,8])</span>
<span class="comment">% ylim([-8,8])</span>
<span class="comment">% scatter(x0_vec(1,1), x0_vec(1,2),30,"b","filled")</span>
<span class="comment">% scatter(x0_vec(2,1), x0_vec(2,2),30,"r","filled")</span>
<span class="comment">% scatter(x0_vec(3,1), x0_vec(3,2),30,"green","filled")</span>
<span class="comment">% scatter(x0_vec(4,1), x0_vec(4,2),30,"m","filled")</span>
<span class="comment">% scatter(x0_vec(5,1), x0_vec(5,2),30,"black","filled")</span>
<span class="comment">% % plot([x0_vec(1,1),x0_vec(2,1)], [x0_vec(1,2),x0_vec(2,2)],"b-.")</span>
<span class="comment">% % plot([x0_vec(2,1),x0_vec(3,1)], [x0_vec(2,2),x0_vec(3,2)],"b-.")</span>
<span class="comment">% % plot([x0_vec(3,1),x0_vec(4,1)], [x0_vec(3,2),x0_vec(4,2)],"b-.")</span>
<span class="comment">% % plot([x0_vec(4,1),x0_vec(5,1)], [x0_vec(4,2),x0_vec(5,2)],"b-.")</span>
<span class="comment">% % plot([x0_vec(1,1),x0_vec(5,1)], [x0_vec(1,2),x0_vec(5,2)],"b-.")</span>
<span class="comment">%</span>
<span class="comment">% scatter(k(1,1), k(1,2),45,"b", "x")</span>
<span class="comment">% scatter(k(2,1), k(2,2),45,"red", "x")</span>
<span class="comment">% scatter(k(3,1), k(3,2),45,"green", "x")</span>
<span class="comment">% scatter(k(4,1), k(4,2),45,"magenta", "x")</span>
<span class="comment">% scatter(k(5,1), k(5,2),45,"black","x")</span>
<span class="comment">% % plot([k(1,1),k(2,1)], [k(1,2),k(2,2)],"r-.")</span>
<span class="comment">% % plot([k(2,1),k(3,1)], [k(2,2),k(3,2)],"r-.")</span>
<span class="comment">% % plot([k(3,1),k(4,1)], [k(3,2),k(4,2)],"r-.")</span>
<span class="comment">% % plot([k(4,1),k(5,1)], [k(4,2),k(5,2)],"r-.")</span>
<span class="comment">% % plot([k(1,1),k(5,1)], [k(1,2),k(5,2)],"r-.")</span>
<span class="comment">%</span>
<span class="comment">% for i = 1:length(T)</span>
<span class="comment">%     plot(z_state.x1(1:i,1), z_state.x1(1:i,2), "b");</span>
<span class="comment">%     plot(z_state.x2(1:i,1), z_state.x2(1:i,2), "red");</span>
<span class="comment">%     plot(z_state.x3(1:i,1), z_state.x3(1:i,2), "green");</span>
<span class="comment">%     plot(z_state.x4(1:i,1), z_state.x4(1:i,2), "magenta");</span>
<span class="comment">%     plot(z_state.x5(1:i,1), z_state.x5(1:i,2), "black");</span>
<span class="comment">%     % pause(0.1)</span>
<span class="comment">%     axis equal</span>
<span class="comment">%     xlim([-5,8])</span>
<span class="comment">%     ylim([-8,8])</span>
<span class="comment">%     drawnow</span>
<span class="comment">% end</span>
<span class="comment">% scatter(z_state.x1(end,1), z_state.x1(end,2),30,"b");</span>
<span class="comment">% scatter(z_state.x2(end,1), z_state.x2(end,2),30,"red");</span>
<span class="comment">% scatter(z_state.x3(end,1), z_state.x3(end,2),30,"green");</span>
<span class="comment">% scatter(z_state.x4(end,1), z_state.x4(end,2),30,"magenta");</span>
<span class="comment">% scatter(z_state.x5(end,1), z_state.x5(end,2),30,"black");</span>
<span class="comment">% % plot([z_state.x1(end,1), z_state.x2(end,1)], [z_state.x1(end,2),z_state.x2(end,2)],"g-.");</span>
<span class="comment">% % plot([z_state.x2(end,1), z_state.x3(end,1)], [z_state.x2(end,2),z_state.x3(end,2)],"g-.");</span>
<span class="comment">% % plot([z_state.x3(end,1), z_state.x4(end,1)], [z_state.x3(end,2),z_state.x4(end,2)],"g-.");</span>
<span class="comment">% % plot([z_state.x4(end,1), z_state.x5(end,1)], [z_state.x4(end,2),z_state.x5(end,2)],"g-.");</span>
<span class="comment">% % plot([z_state.x5(end,1), z_state.x1(end,1)], [z_state.x5(end,2),z_state.x1(end,2)],"g-.");</span>

<span class="keyword">function</span> z_dot = myodefun(t, z, A, k, k_gain, gamma_gain)

    x = [z(1:5), z(11:15)];
    v = [z(6:10,:), z(16:20)];

    formation_x_dot = zeros(5,2);

    x_dot = zeros(5, 2);
    v_dot = zeros(5, 2);
    v_dot_x = zeros(5, 2);
    v_dot_v = zeros(5, 2);
    <span class="keyword">for</span> i = 1:5
        <span class="comment">% 2 element vectors</span>
        xi = x(i,:);
        ki = k(i,:);
        vi = v(i,:);

        neighbors = find(A(i,:));
        <span class="comment">% Summation portion</span>
        <span class="keyword">for</span> j = neighbors
            <span class="comment">% 2 element vectors</span>
            xj = x(j, :);
            vj = v(j, :);
            kj = k(j, :);

            aij = A(i,j);

            <span class="comment">% First, do formation control</span>
            formation_x_dot(i,:) = formation_x_dot(i,:) - ((xi-xj)-(ki-kj)); <span class="comment">% negative because summation is negative</span>

            <span class="comment">% Find v_dot</span>
            v_dot_x(i,:) = v_dot_x(i,:) + aij*(xj-xi);
            v_dot_v(i,:) = v_dot_v(i,:) + aij*(vj-vi);

            <span class="comment">% pause(1)</span>
        <span class="keyword">end</span>

        <span class="comment">% Correct all of our sums here</span>
        <span class="comment">% x_dot(i,:) = formation_x_dot(i,:);</span>

        <span class="comment">% x_dot(i,:) = formation_x_dot(i,:) + (k_gain*gamma_gain)*v(i,:);</span>
        x_dot(i,:) = v(i,:);
        v_dot(i,:) = formation_x_dot(i,:) + (k_gain*gamma_gain)*v_dot_v(i,:);
        <span class="comment">% v_dot(i,:) = k_gain*v_dot_x(i,:) + (k_gain*gamma_gain)*v_dot_v(i,:);</span>
    <span class="keyword">end</span>

    z_dot(1:5) = x_dot(:,1);
    z_dot(6:10) = v_dot(:,1);
    <span class="comment">% z_dot(11:15) = psi_dot(:,1);</span>

    z_dot(11:15) = x_dot(:,2);
    z_dot(16:20) = v_dot(:,2);
    <span class="comment">% z_dot(26:30) = psi_dot(:,2);</span>

    z_dot = transpose(z_dot);

<span class="keyword">end</span>
</pre>
<pre class="codeoutput">
k =

     0    -1
     0     1
     1     0
     0     0
    -1    -1

</pre>
<img vspace="5" hspace="5" src="HW2_01.png" alt=""> <img vspace="5" hspace="5" src="HW2_02.png" alt=""> <img vspace="5" hspace="5" src="HW2_03.png" alt=""> <img vspace="5" hspace="5" src="HW2_04.png" alt=""> <img vspace="5" hspace="5" src="HW2_05.png" alt=""> <img vspace="5" hspace="5" src="HW2_06.png" alt=""> <img vspace="5" hspace="5" src="HW2_07.png" alt=""> <img vspace="5" hspace="5" src="HW2_08.png" alt=""> <img vspace="5" hspace="5" src="HW2_09.png" alt=""> <img vspace="5" hspace="5" src="HW2_10.png" alt=""> <p class="footer">
<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2024b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Romeo Perlstein HW2
% Help! I need somebody
close all
clear

%% Q1
% given the following grpah:
G = [2 0 0 0 0;
     0 2 0 0 0;
     0 0 2 0 0;
     0 0 0 2 0;
     0 0 0 0 2];
A = [0 1 0 0 1;
     1 0 1 0 0;
     0 1 0 1 0;
     0 0 1 0 1;
     1 0 0 1 0];

L = G - A;

% Given
x0_vec = [-4, -5;
          -2,  2;
           1,  6;
           7,  0;
           5, -6];

k_vec_relative = [0, -1;
                  0,  1;
                  1,  0;
                  0,  0;
                 -1, -1];
% k_vec_relative = [1,1;
%                   0,0;
%                   0,0;
%                   0,0;
%                   0,0];

% k = x0_vec + k_vec_relative
k = k_vec_relative

v0_vec = zeros(5,2);

z0_vec = [x0_vec; v0_vec];
z0_vec_1d = z0_vec(:);

k_gain = 2.5;
gamma_gain = 0.7;

tall_er_ant = (10^-13); % Tolerance
step_size = 0.025; % step size 
max_time = 8; % max time (0->max_time)
t = [0:step_size:max_time]; % timestep

% ODE options
ODE_options = odeset("RelTol", tall_er_ant, "AbsTol", tall_er_ant);

[T,Z] = ode45(@myodefun, t, z0_vec_1d, ODE_options, A, k, k_gain, gamma_gain);

z_state.x1 = [Z(:,1), Z(:,11)];
z_state.x2 = [Z(:,2), Z(:,12)];
z_state.x3 = [Z(:,3), Z(:,13)];
z_state.x4 = [Z(:,4), Z(:,14)];
z_state.x5 = [Z(:,5), Z(:,15)];

z_state.v1 = [Z(:,6), Z(:,16)];
z_state.v2 = [Z(:,7), Z(:,17)];
z_state.v3 = [Z(:,8), Z(:,18)];
z_state.v4 = [Z(:,9), Z(:,19)];
z_state.v5 = [Z(:,10), Z(:,20)];

count = 1;
z_state.psi1 = zeros(length(t),2);
z_state.psi2 = zeros(length(t),2);
z_state.psi3 = zeros(length(t),2);
z_state.psi4 = zeros(length(t),2);
z_state.psi5 = zeros(length(t),2);

for i = 1:length(t)
    z_state.psi1(i, :) = z_state.x1(i,:) - k(1,:);
    z_state.psi2(i, :) = z_state.x2(i,:) - k(2,:);
    z_state.psi3(i, :) = z_state.x3(i,:) - k(3,:);
    z_state.psi4(i, :) = z_state.x4(i,:) - k(4,:);
    z_state.psi5(i, :) = z_state.x5(i,:) - k(5,:);
end

% z_state.psi1 = [Z(:,11), Z(:,26)];
% z_state.psi2 = [Z(:,12), Z(:,27)];
% z_state.psi3 = [Z(:,13), Z(:,28)];
% z_state.psi4 = [Z(:,14), Z(:,29)];
% z_state.psi5 = [Z(:,15), Z(:,30)];
% 
% Position
figure;
hold on
plot(t, z_state.x1)
yline(k(1,1), "b-.")
yline(k(1,2), "r-.")
legend(["x", "y", "x_{desired}", "y_{desired}"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 1 Position State Over Time")
grid on

figure;
hold on
plot(t, z_state.x2)
yline(k(2,1), "b-.")
yline(k(2,2), "r-.")
legend(["x", "y", "x_{desired}", "y_{desired}"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 2 Position State Over Time")
grid on
ylim([-3, 4])

figure;
hold on
plot(t, z_state.x3)
yline(k(3,1), "b-.")
yline(k(3,2), "r-.")
legend(["x", "y", "x_{desired}", "y_{desired}"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 3 Position State Over Time")
grid on

figure;
hold on
plot(t, z_state.x4)
yline(k(4,1), "b-.")
yline(k(4,2), "r-.")
legend(["x", "y", "x_{desired}", "y_{desired}"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 4 Position State Over Time")
grid on

figure;
hold on
plot(t, z_state.x5)
yline(k(5,1), "b-.")
yline(k(5,2), "r-.")
legend(["x", "y", "x_{desired}", "y_{desired}"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 5 Position State Over Time")
grid on


% Velocity
figure;
hold on
plot(t, z_state.v1)
legend(["v_x", "v_y"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 1 Velocity State Over Time")
grid on

figure;
hold on
plot(t, z_state.v2)
legend(["v_x", "v_y"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 2 Velocity State Over Time")
grid on

figure;
hold on
plot(t, z_state.v3)
legend(["v_x", "v_y"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 3 Velocity State Over Time")
grid on

figure;
hold on
plot(t, z_state.v4)
legend(["v_x", "v_y"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 4 Velocity State Over Time")
grid on

figure;
hold on
plot(t, z_state.v5)
legend(["v_x", "v_y"])
xlabel("time (s)")
ylabel("state")
title("Plot of Node 5 Velocity State Over Time")
grid on



% figure;
% title("Plot of \psi Over Time")
% xlabel("X")
% ylabel("Y")
% hold on
% grid on
% yline(0, "-.");
% xline(0, "-.");
% for i = 1:length(T)
%     plot(z_state.psi1(1:i,1), z_state.psi1(1:i,2), "blue", LineWidth=1.5)
%     plot(z_state.psi2(1:i,1), z_state.psi2(1:i,2), "red", LineWidth=1.5)
%     plot(z_state.psi3(1:i,1), z_state.psi3(1:i,2), "green", LineWidth=1.5)
%     plot(z_state.psi4(1:i,1), z_state.psi4(1:i,2), "magenta", LineWidth=1.5)
%     plot(z_state.psi5(1:i,1), z_state.psi5(1:i,2), "black", LineWidth=1.5)
% 
%     drawnow
% end
% scatter(z_state.psi1(end,1), z_state.psi1(end,2), "blue")
% scatter(z_state.psi2(end,1), z_state.psi2(end,2), "red")
% scatter(z_state.psi3(end,1), z_state.psi3(end,2), "green")
% scatter(z_state.psi4(end,1), z_state.psi4(end,2), "magenta")
% scatter(z_state.psi5(end,1), z_state.psi5(end,2), "black")
% legend(["x_0", "y_0", "V_1", "V_2", "V_3", "V_4", "V_5"])
% 
% 
% 
% figure;
% hold on;
% grid on;
% title("Plot of X State (Top-down View)")
% xlabel("X")
% ylabel("Y")
% axis equal
% xlim([-5,8])
% ylim([-8,8])
% scatter(x0_vec(1,1), x0_vec(1,2),30,"b","filled")
% scatter(x0_vec(2,1), x0_vec(2,2),30,"r","filled")
% scatter(x0_vec(3,1), x0_vec(3,2),30,"green","filled")
% scatter(x0_vec(4,1), x0_vec(4,2),30,"m","filled")
% scatter(x0_vec(5,1), x0_vec(5,2),30,"black","filled")
% % plot([x0_vec(1,1),x0_vec(2,1)], [x0_vec(1,2),x0_vec(2,2)],"b-.")
% % plot([x0_vec(2,1),x0_vec(3,1)], [x0_vec(2,2),x0_vec(3,2)],"b-.")
% % plot([x0_vec(3,1),x0_vec(4,1)], [x0_vec(3,2),x0_vec(4,2)],"b-.")
% % plot([x0_vec(4,1),x0_vec(5,1)], [x0_vec(4,2),x0_vec(5,2)],"b-.")
% % plot([x0_vec(1,1),x0_vec(5,1)], [x0_vec(1,2),x0_vec(5,2)],"b-.")
% 
% scatter(k(1,1), k(1,2),45,"b", "x")
% scatter(k(2,1), k(2,2),45,"red", "x")
% scatter(k(3,1), k(3,2),45,"green", "x")
% scatter(k(4,1), k(4,2),45,"magenta", "x")
% scatter(k(5,1), k(5,2),45,"black","x")
% % plot([k(1,1),k(2,1)], [k(1,2),k(2,2)],"r-.")
% % plot([k(2,1),k(3,1)], [k(2,2),k(3,2)],"r-.")
% % plot([k(3,1),k(4,1)], [k(3,2),k(4,2)],"r-.")
% % plot([k(4,1),k(5,1)], [k(4,2),k(5,2)],"r-.")
% % plot([k(1,1),k(5,1)], [k(1,2),k(5,2)],"r-.")
% 
% for i = 1:length(T)
%     plot(z_state.x1(1:i,1), z_state.x1(1:i,2), "b");
%     plot(z_state.x2(1:i,1), z_state.x2(1:i,2), "red");
%     plot(z_state.x3(1:i,1), z_state.x3(1:i,2), "green");
%     plot(z_state.x4(1:i,1), z_state.x4(1:i,2), "magenta");
%     plot(z_state.x5(1:i,1), z_state.x5(1:i,2), "black");
%     % pause(0.1)
%     axis equal
%     xlim([-5,8])
%     ylim([-8,8])
%     drawnow
% end
% scatter(z_state.x1(end,1), z_state.x1(end,2),30,"b");
% scatter(z_state.x2(end,1), z_state.x2(end,2),30,"red");
% scatter(z_state.x3(end,1), z_state.x3(end,2),30,"green");
% scatter(z_state.x4(end,1), z_state.x4(end,2),30,"magenta");
% scatter(z_state.x5(end,1), z_state.x5(end,2),30,"black");
% % plot([z_state.x1(end,1), z_state.x2(end,1)], [z_state.x1(end,2),z_state.x2(end,2)],"g-.");
% % plot([z_state.x2(end,1), z_state.x3(end,1)], [z_state.x2(end,2),z_state.x3(end,2)],"g-.");
% % plot([z_state.x3(end,1), z_state.x4(end,1)], [z_state.x3(end,2),z_state.x4(end,2)],"g-.");
% % plot([z_state.x4(end,1), z_state.x5(end,1)], [z_state.x4(end,2),z_state.x5(end,2)],"g-.");
% % plot([z_state.x5(end,1), z_state.x1(end,1)], [z_state.x5(end,2),z_state.x1(end,2)],"g-.");

function z_dot = myodefun(t, z, A, k, k_gain, gamma_gain)
    
    x = [z(1:5), z(11:15)];
    v = [z(6:10,:), z(16:20)];

    formation_x_dot = zeros(5,2);

    x_dot = zeros(5, 2);
    v_dot = zeros(5, 2);
    v_dot_x = zeros(5, 2);
    v_dot_v = zeros(5, 2);
    for i = 1:5
        % 2 element vectors
        xi = x(i,:);
        ki = k(i,:);
        vi = v(i,:);

        neighbors = find(A(i,:));
        % Summation portion
        for j = neighbors
            % 2 element vectors
            xj = x(j, :);
            vj = v(j, :);
            kj = k(j, :);

            aij = A(i,j);

            % First, do formation control
            formation_x_dot(i,:) = formation_x_dot(i,:) - ((xi-xj)-(ki-kj)); % negative because summation is negative

            % Find v_dot
            v_dot_x(i,:) = v_dot_x(i,:) + aij*(xj-xi);
            v_dot_v(i,:) = v_dot_v(i,:) + aij*(vj-vi);

            % pause(1)
        end

        % Correct all of our sums here
        % x_dot(i,:) = formation_x_dot(i,:);

        % x_dot(i,:) = formation_x_dot(i,:) + (k_gain*gamma_gain)*v(i,:);
        x_dot(i,:) = v(i,:);
        v_dot(i,:) = formation_x_dot(i,:) + (k_gain*gamma_gain)*v_dot_v(i,:);
        % v_dot(i,:) = k_gain*v_dot_x(i,:) + (k_gain*gamma_gain)*v_dot_v(i,:);
    end

    z_dot(1:5) = x_dot(:,1);
    z_dot(6:10) = v_dot(:,1);
    % z_dot(11:15) = psi_dot(:,1);

    z_dot(11:15) = x_dot(:,2);
    z_dot(16:20) = v_dot(:,2);
    % z_dot(26:30) = psi_dot(:,2);

    z_dot = transpose(z_dot);

end
##### SOURCE END #####
-->
</body>
</html>
